<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Loan List</h1>
  <table class="table-auto w-full border-collapse">
    <thead>
      <tr class="bg-gray-100">
        <th class="px-4 py-2 text-left">Account</th>
        <th class="px-4 py-2 text-left">Borrower</th>
        <th class="px-4 py-2 text-left">Status</th>
        <th class="px-4 py-2 text-left">Amount Due</th>
        <th class="px-4 py-2 text-left">Next Payment Date</th>
        <th class="px-4 py-2 text-left">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @loans.each do |loan| %>
        <% # Ensure loan.data is parsed and accessible %>
        <% parsed_data = loan.data || {} %> <!-- Make sure parsed_data is a fallback empty hash if loan.data is nil -->
        <tr class="border-b">
          <td class="px-4 py-2"><%= loan.account %></td>
          <td class="px-4 py-2"><%= parsed_data.dig('PrimaryBorrower', 'FullName') || 'N/A' %></td>
          <td class="px-4 py-2"><%= parsed_data['ServiceStatus'] || 'N/A' %></td>
          <td class="px-4 py-2"><%= parsed_data.dig('Terms', 'RemainingBalance') || 'N/A' %></td>
          <td class="px-4 py-2"><%= parsed_data.dig('Terms', 'NextDueDate') || 'N/A' %></td>
          <td class="px-4 py-2">
            <%= link_to 'View Details', loan_path(loan), class: "text-blue-500 hover:text-blue-700" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
